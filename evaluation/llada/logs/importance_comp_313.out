=========================================
Job ID: 313
Node: gs14
Start time: Tuesday, November 25, 2025 PM08:45:24 HKT
=========================================
Using GPUs: 4,5
=========================================

=========================================
STEP 1: Generate Average Head Importance
=========================================
================================================================================
Generate Average Head Importance from Attribution Results
================================================================================
Input: /home/qiheng/Projects/adaptive-dllm/attribution_results_20251124_005811
Output: /home/qiheng/Projects/adaptive-dllm/configs/head_importance
================================================================================

Loading attribution results...
Found 3 runs: ['run_1_seed_47', 'run_2_seed_123', 'run_3_seed_2024']
  Loaded run_1_seed_47/safety: shape (32, 32)
  Loaded run_1_seed_47/code: shape (32, 32)
  Loaded run_1_seed_47/science: shape (32, 32)
  Loaded run_1_seed_47/math: shape (32, 32)
  Loaded run_1_seed_47/chat: shape (32, 32)
  Loaded run_2_seed_123/safety: shape (32, 32)
  Loaded run_2_seed_123/code: shape (32, 32)
  Loaded run_2_seed_123/science: shape (32, 32)
  Loaded run_2_seed_123/math: shape (32, 32)
  Loaded run_2_seed_123/chat: shape (32, 32)
  Loaded run_3_seed_2024/safety: shape (32, 32)
  Loaded run_3_seed_2024/code: shape (32, 32)
  Loaded run_3_seed_2024/science: shape (32, 32)
  Loaded run_3_seed_2024/math: shape (32, 32)
  Loaded run_3_seed_2024/chat: shape (32, 32)

Computing global average...

================================================================================
Global Average Attribution Statistics
================================================================================
Total samples averaged: 15 (runs=3, categories=5)
Shape: (32, 32)
Mean: -0.070837
Std: 0.303862
Min: -7.291168
Max: 1.655876

Absolute Attribution (Importance) Statistics:
Mean: 0.113223
Std: 0.290742
Min: 0.000044
Max: 7.291168

Saving importance configurations...

Saved raw attribution to: /home/qiheng/Projects/adaptive-dllm/configs/head_importance/average_attribution.npy
Saved importance scores to: /home/qiheng/Projects/adaptive-dllm/configs/head_importance/average_importance.npy
Saved PyTorch format to: /home/qiheng/Projects/adaptive-dllm/configs/head_importance/head_importance.pt
Saved normalized importance to: /home/qiheng/Projects/adaptive-dllm/configs/head_importance/normalized_importance.npy
Saved metadata to: /home/qiheng/Projects/adaptive-dllm/configs/head_importance/importance_metadata.json

================================================================================
Generating Sparsity Configurations
================================================================================
  Keep 20%: threshold=0.143882, n_heads=205/1024
  Keep 30%: threshold=0.093532, n_heads=308/1024
  Keep 40%: threshold=0.061639, n_heads=410/1024
  Keep 50%: threshold=0.043364, n_heads=513/1024
  Keep 60%: threshold=0.031136, n_heads=615/1024
  Keep 70%: threshold=0.021568, n_heads=717/1024
  Keep 80%: threshold=0.012506, n_heads=820/1024

All sparsity configs saved to: /home/qiheng/Projects/adaptive-dllm/configs/head_importance/sparsity_configs/

Generating visualization...
ERROR: Failed to generate average importance
